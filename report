#!/usr/bin/perl
use AppMercado;

#INFO: XXX

logm("DBG",9,"Comienzo de reporte",);

my $mem={};
my %global;
my $tx=dbTxStart();
dbFindFold('T="deptos" AND TIPO="CARACTERISTICAS"',{},[],\&loadMem);
dbTxCommit($tx,0,'OK');


logm("LOOP",9,"DATA: #1",\%mem);
print "Cantidad:", $mem{'GLOBAL'}->{'CANTIDAD'};

while ( ($k,$v) = each %{$mem{'GLOBAL'}->{'AMENITIES'}} ) { print "<br/>$k => $v"; }


sub loadMem {
        my ($dr)= @_;
	my %amenities;

	my %temp;
	my %d=%{$dr->{'DEPTOS'}}; 
	$global{'CANTIDAD'}++;	
	#A:Tengo a $d que es un hash del depto
        my %args= (split(/[\=\|]/,$d{'AMENITIES'}));
        while((my $key, my $value) = each(%args)) {
        	if($value eq 'SI'){
                	$amenities{$key}= $value; 
                	$global{'AMENITIES'}->{$key}++;        
		}
	}
	
	$temp{'AMENITIES'}= join('',keys (%amenities));
	$mem{$d{'NOMBRE'}}->{'AMENITIES'}=$temp{'AMENITIES'};
	$mem{'GLOBAL'}=\%global;
	#logm("LOOP",9,"DATA: #1",\%mem);
}

